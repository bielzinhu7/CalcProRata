<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Calculadora PrÃ³-Rata â€” MudanÃ§a de Vencimento</title>
<style>
:root{
  --roxo:#9900ff;--roxo-ana-1:#7a00cc;--roxo-ana-2:#cc00ff;--amarelo:#ffff00;--ama-ana-1:#ffd500;--ama-ana-2:#e6ff00;
  --bg:#0e0a15;--bg-grad:#150f22;--card:#16142a;--bd:#2a2644;--text:#f5f7fb;--muted:#a6acc2;
  --brand:var(--roxo);--brand-hover:#8a00e6;--accent:var(--amarelo);--accent-ink:#1a1a1a;--ok:#34d399;--err:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:linear-gradient(180deg,var(--bg),var(--bg-grad));color:var(--text)}
.wrap{max-width:980px;margin:0 auto;padding:22px;text-align:center}
h1{margin:0 0 8px;font-size:28px}
.sub{color:var(--muted);margin:0 6px 6px;font-size:16px}
.info{color:var(--accent);font-size:14px;margin-bottom:18px}
.next{display:inline-flex;gap:8px;align-items:center;justify-content:center;background:#1a1832;border:1px solid #2f2b4f;color:var(--text);padding:8px 12px;border-radius:999px;font-size:13px;margin:0 auto}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;text-align:left;align-items:start}
.card{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:16px}
label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
input[type="text"],input[type="number"],input[type="date"],select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--bd);background:#101029;color:var(--text);transition:border-color .2s,box-shadow .2s}
input:focus,select:focus{outline:none;border-color:var(--roxo-ana-2);box-shadow:0 0 0 3px rgba(153,0,255,.25)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.mt-12{margin-top:12px}.mt-10{margin-top:10px}
.small{font-size:12px;color:var(--muted)}
.radio{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px}
.btn{padding:10px 14px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:transform .06s ease,filter .15s ease,box-shadow .15s ease, .15s ease,border-color .15s ease;user-select:none}
.btn:active{transform:translateY(1px)}
.btn-primary{background:linear-gradient(180deg,var(--brand),var(--roxo-ana-1));border-color:#5a38a6;color:white;box-shadow:0 6px 16px rgba(153,0,255,.25)}
.btn-primary:hover{filter:brightness(1.03);box-shadow:0 8px 20px rgba(153,0,255,.35);background:linear-gradient(180deg,var(--brand-hover),var(--roxo-ana-1))}
.btn-ghost{background:#1a1832;border-color:#2f2b4f;color:var(--text)}
.btn-ghost:hover{background:#221e42;border-color:#47407a}
summary{cursor:pointer;color:var(--accent)}
summary:hover{text-decoration:underline;text-decoration-color:var(--ama-ana-1)}
.kv{display:flex;justify-content:space-between;margin:6px 0}
.ok{color:var(--ok)}.err{color:var(--err)}.muted{color:var(--muted)}
pre{white-space:pre-wrap;line-height:1.35;margin:8px 0 0}

/* CENTRALIZAÃ‡ÃƒO E RESPIRO DOS BOTÃ•ES */
.actions{
  display:flex;
  justify-content:center;   /* centraliza horizontal */
  align-items:center;       /* garante alinhamento vertical */
  gap:10px;                 /* espaÃ§o entre botÃµes */
  padding:20px 0;           /* mais espaÃ§o acima/abaixo */
}

/* Responsivo */
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Calculadora de PrÃ³-Rata</h1>
    <p class="sub">Troca do <strong>dia de vencimento</strong> do plano (regras internas TNT).</p>
    <p class="info">A PrÃ³-Rata vai junto com a prÃ³xima mensalidade.</p>
    <div class="next"><span>ðŸ“… PrÃ³xima cobranÃ§a:</span><strong id="nextDate">â€”</strong></div>

    <div class="grid mt-12">
      <div class="card">
        <div class="row">
          <div>
            <label for="valor">Valor da mensalidade (R$)</label>
            <input id="valor" type="text" inputmode="numeric" placeholder="0,00" value="0,00" autocomplete="off">
          </div>
          <div>
            <label for="dataUltimo">Data do <strong>Ãºltimo vencimento</strong></label>
            <input id="dataUltimo" type="date">
            <div class="small">Ex.: se a Ãºltima fatura venceu em 29/10, selecione 2025-10-29.</div>
          </div>
        </div>

        <div class="row mt-12">
          <div>
            <label for="diaAtual">Dia atual do vencimento</label>
            <input id="diaAtual" type="number" min="1" max="31" placeholder="Ex.: 29">
          </div>
          <div>
            <label for="diaNovo">Novo dia de vencimento</label>
            <input id="diaNovo" type="number" min="1" max="31" placeholder="Ex.: 6">
          </div>
        </div>

        <div class="row mt-12">
          <div>
            <label for="parcelasAbertas">Tem parcelas em aberto?</label>
            <select id="parcelasAbertas">
              <option value="nao">NÃ£o</option>
              <option value="sim">Sim</option>
            </select>
          </div>
          <div>
            <label>Quando aplicar</label>
            <div class="radio" id="radioGroup">
              <label><input type="radio" name="aplicacao" value="proxima" checked> Logo em seguida (prÃ³xima ocorrÃªncia do novo dia)</label>
              <label><input type="radio" name="aplicacao" value="mesSeguinte"> No prÃ³ximo ciclo (pula um mÃªs)</label>
            </div>
          </div>
        </div>

        <div class="small">
          â€¢ Se <strong>adiantar</strong> (ex.: 29 â†’ 6) e aplicar <em>logo em seguida</em>, nÃ£o cobra PrÃ³â€‘Rata.<br>
          â€¢ Aplicando <em>no prÃ³ximo ciclo</em>, pode haver PrÃ³â€‘Rata se a diferenÃ§a de dias for â‰¥ 6.
        </div>

        <div class="actions">
          <button id="calc" class="btn btn-primary">Calcular</button>
          <button id="reset" class="btn btn-ghost">Limpar</button>
        </div>
      </div>

      <div class="card">
        <h2>Resultado</h2>
        <div class="kv"><span>Status:</span><strong id="status" class="muted">â€”</strong></div>
        <div class="kv"><span>Dias considerados:</span><strong id="dias">â€”</strong></div>
        <div class="kv"><span>PrÃ³â€‘Rata:</span><strong id="prorata">â€”</strong></div>
        <div class="kv"><span>Total (mensalidade + PrÃ³â€‘Rata):</span><strong id="total">â€”</strong></div>
        <details class="mt-10">
          <summary>Como calculamos</summary>
          <pre id="exp"></pre>
        </details>
      </div>
    </div>
  </div>

<script>
const BRL=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});
const fmt=v=>BRL.format(Math.max(0,Number(v||0)));
const r2=v=>Math.round((Number(v)||0)*100)/100;

// mÃ¡scara simples para R$
const valorInput=document.getElementById("valor");
valorInput.addEventListener("input",e=>{
  let raw=e.target.value.replace(/\D/g,"");
  if(raw==="")raw="0";
  const num=parseFloat(raw)/100;
  e.target.value=num.toFixed(2).replace(".",",");
});
valorInput.addEventListener("focus",e=>e.target.select());

// datas utilitÃ¡rias
function todayISO(){
  const now=new Date();
  const y=now.getFullYear();
  const m=String(now.getMonth()+1).padStart(2,"0");
  const d=String(now.getDate()).padStart(2,"0");
  return `${y}-${m}-${d}`;
}
function parseISOToDate(iso){const [y,m,d]=iso.split("-").map(Number);const dt=new Date(y,m-1,d);dt.setHours(0,0,0,0);return dt;}
function clampDay(y,m,day){const last=new Date(y,m+1,0).getDate();return Math.min(day,last)}
function formatBRDate(d){return d.toLocaleDateString("pt-BR",{timeZone:"America/Sao_Paulo"})}
function monthClamped(y,m,day){return new Date(y,m,clampDay(y,m,day));}

// calcula a prÃ³xima cobranÃ§a com base no ÃšLTIMO vencimento informado
function computeNextChargeDate(baseDateISO,diaAtual,diaNovo,mode){
  if(!(diaAtual>=1&&diaAtual<=31) || !(diaNovo>=1&&diaNovo<=31) || !baseDateISO) return "â€”";
  const base=parseISOToDate(baseDateISO); // Ãºltimo vencimento
  let y=base.getFullYear(), m=base.getMonth();

  // escolha do mÃªs alvo em relaÃ§Ã£o ao Ãºltimo vencimento
  let targetMonth;
  if(mode==="proxima"){ // logo em seguida
    targetMonth = (diaNovo>diaAtual)? m : m+1;
  }else{ // "mesSeguinte" â€” prÃ³ximo ciclo
    targetMonth = (diaNovo>diaAtual)? m+1 : m+2;
  }

  // candidata
  let cand = monthClamped(y, targetMonth, diaNovo);
  cand.setHours(0,0,0,0);

  // garante que NUNCA seja anterior ao Ãºltimo vencimento
  while(cand <= base){
    targetMonth += 1;
    cand = monthClamped(y, targetMonth, diaNovo);
    cand.setHours(0,0,0,0);
  }
  return formatBRDate(cand);
}

function calcularProrata({valor,diaAtual,diaNovo,parcelasAbertas,aplicacao}){
  const explic=[];
  if(parcelasAbertas==="sim"){
    return{
      permitido:false,status:"Bloqueado",dias:0,prorata:0,total:valor,
      explain:"NÃ£o dÃ¡ pra mudar agora: existem parcelas em aberto."
    };
  }
  const movimento=(diaNovo>diaAtual)?"postergar":(diaNovo<diaAtual?"adiantar":"igual");
  explic.push(`Movimento: ${movimento==="postergar"?"postergar (novo > atual)":movimento==="adiantar"?"adiantar (novo < atual)":"sem mudanÃ§a"}.`);

  let diasConsiderados=0, cobra=false;

  if(movimento==="igual"){
    explic.push("Dia novo igual ao atual: 0 dia(s). Sem PrÃ³â€‘Rata.");
  }else if(movimento==="postergar"){
    diasConsiderados=diaNovo-diaAtual;
    explic.push(`DiferenÃ§a: ${diaNovo} - ${diaAtual} = ${diasConsiderados} dia(s).`);
    cobra = diasConsiderados>=6;
    explic.push(cobra?"DiferenÃ§a â‰¥ 6 dias â‡’ cobrar PrÃ³â€‘Rata.":"DiferenÃ§a < 6 dias â‡’ nÃ£o cobrar PrÃ³â€‘Rata.");
  }else if(movimento==="adiantar"){
    if(aplicacao==="proxima"){
      explic.push("AplicaÃ§Ã£o logo em seguida (mÃªs imediatamente apÃ³s o Ãºltimo vencimento). Adiantamento â‡’ nÃ£o cobra PrÃ³â€‘Rata.");
      diasConsiderados=0; cobra=false;
    }else{
      diasConsiderados=(30-diaAtual)+diaNovo; // critÃ©rio interno usando mÃªs comercial de 30 dias
      explic.push(`AplicaÃ§Ã£o no prÃ³ximo ciclo: (30 - ${diaAtual}) + ${diaNovo} = ${diasConsiderados}.`);
      cobra = diasConsiderados>=6;
      explic.push(cobra?"DiferenÃ§a â‰¥ 6 dias â‡’ cobrar PrÃ³â€‘Rata.":"DiferenÃ§a < 6 dias â‡’ nÃ£o cobrar PrÃ³â€‘Rata.");
    }
  }

  const prorata=cobra?r2((valor/30)*diasConsiderados):0;
  const total=r2(valor+prorata);

  const resumo=[
    `Mensalidade: ${fmt(valor)}.`,
    `Base: valor Ã· 30 Ã— dias = ${fmt(valor)} Ã· 30 Ã— ${diasConsiderados} = ${fmt((valor/30)*diasConsiderados)}.`,
    `Arredondado para 2 casas.`,
    `PrÃ³â€‘Rata: ${fmt(prorata)}.`,
    `Total (mensalidade + PrÃ³â€‘Rata): ${fmt(total)}.`
  ].join("\n");

  return{permitido:true,status:"Permitido",dias:diasConsiderados,prorata,total,explain:(explic.join("\n")+"\n\n"+resumo).trim()};
}

function getVals(){
  const valorStr=document.getElementById("valor").value.replace(/\./g,"").replace(",",".");
  return{
    valor:Number(valorStr||0),
    diaAtual:Number(document.getElementById("diaAtual").value||0),
    diaNovo:Number(document.getElementById("diaNovo").value||0),
    parcelasAbertas:document.getElementById("parcelasAbertas").value,
    aplicacao:[...document.querySelectorAll('input[name="aplicacao"]')].find(r=>r.checked)?.value||"proxima"
  };
}

function show(res){
  const statusEl=document.getElementById("status");
  statusEl.textContent=res.status;
  statusEl.className=res.permitido?"ok":"err";
  document.getElementById("dias").textContent=res.dias;
  document.getElementById("prorata").textContent=fmt(res.prorata);
  document.getElementById("total").textContent=fmt(res.total);
  document.getElementById("exp").textContent=res.explain;
}

function updateNextDate(){
  const base=document.getElementById("dataUltimo").value; // pode ser passado ou futuro
  const diaAtual=Number(document.getElementById("diaAtual").value||0);
  const diaNovo=Number(document.getElementById("diaNovo").value||0);
  const modo=[...document.querySelectorAll('input[name="aplicacao"]')].find(r=>r.checked)?.value||"proxima";
  document.getElementById("nextDate").textContent=computeNextChargeDate(base,diaAtual,diaNovo,modo);
}

// listeners
["diaAtual","diaNovo","dataUltimo"].forEach(id=>document.getElementById(id).addEventListener("input",updateNextDate));
document.getElementById("radioGroup").addEventListener("change",updateNextDate);

// aÃ§Ãµes
 document.getElementById("calc").addEventListener("click",()=>{
  const v=getVals();
  if(v.valor<=0){alert("Informe o valor da mensalidade.");return;}
  if(!(v.diaAtual>=1&&v.diaAtual<=31)){alert("Informe o dia atual (1 a 31).");return;}
  if(!(v.diaNovo>=1&&v.diaNovo<=31)){alert("Informe o novo dia (1 a 31).");return;}
  const res=calcularProrata(v);
  show(res);
});

 document.getElementById("reset").addEventListener("click",()=>{
  document.getElementById("valor").value="0,00";
  ["diaAtual","diaNovo"].forEach(id=>document.getElementById(id).value="");
  document.getElementById("parcelasAbertas").value="nao";
  document.querySelector('input[name="aplicacao"][value="proxima"]').checked=true;
  // mantÃ©m ou limpa a data do Ãºltimo vencimento? vamos limpar para evitar confusÃ£o
  document.getElementById("dataUltimo").value="";
  show({permitido:false,status:"â€”",dias:"â€”",prorata:0,total:0,explain:""});
  updateNextDate();
});

// init â€” sugere hoje como data padrÃ£o (pode ser alterada livremente)
document.getElementById("dataUltimo").value=todayISO();
updateNextDate();
show({permitido:false,status:"â€”",dias:"â€”",prorata:0,total:0,explain:""});
</script>
</body>
</html>
